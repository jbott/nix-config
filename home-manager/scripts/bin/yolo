#!/usr/bin/env bash
set -euo pipefail

# Change to repository root if in a jj or git repository
root=$(jj workspace root 2>/dev/null) || root=$(git rev-parse --show-toplevel 2>/dev/null) || true
if [[ -n "${root:-}" ]]; then
    cd "$root"
fi

# Bash is excluded from allowedTools so unsandboxed commands still prompt for approval.
# Sandboxed bash is auto-allowed via autoAllowBashIfSandboxed.
exec claude \
    --settings '{"sandbox": {"enabled": true, "autoAllowBashIfSandboxed": true}, "permissions": {"allow": ["WebFetch"]}}' \
    --permission-mode acceptEdits \
    --allowedTools "Edit,Read,Write,Glob,Grep,WebFetch,WebSearch,Skill,Task,TaskOutput,TodoWrite,NotebookEdit,KillShell,AskUserQuestion,EnterPlanMode,ExitPlanMode" \
    "$@"
